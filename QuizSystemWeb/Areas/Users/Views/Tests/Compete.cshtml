@model QuestionsListingServiceModel
@{
    var cnt = 1;
}
<form method="post">
    <input id="testId" type="hidden" value="@Model.QuestionsList.First().TestId"/>
    <input id="duration" type="hidden" value="@Model.QuestionsList.First().Test.Duration"/>
    @foreach (var question in Model.QuestionsList)
    {
        <div class="container mb-5">
            <div class="row">
                <div class="col-12">
                    <p class="fw-bold">@cnt. @question.Content</p>
                    <div>
                        @if (question.QuestionType == "Closed")
                        {
                            @foreach (var answer in question.Answers)
                            {

                                <label for="@answer.Id" class="box first">
                                    <div class="course">
                                        <input type="radio" name="@question.Id" id="@answer.Id">
                                        <span class="subject">@answer.Content</span>
                                    </div>
                                </label>
                            }

                        }
                        else
                        {
                            <div class="form-group">
                                <textarea class="form-control" id="@question.Id" rows="5"></textarea>
                            </div>

                        }

                    </div>
                </div>

            </div>
        </div>
        cnt++;
    }
    <div class="col-12">
        <div class="d-flex justify-content-center"> <button class="btn-primary btn-custom btn-primary-custom px-4 py-2 fw-bold" onclick="onClick(event);"> Submit</button> </div>
    </div>
</form>


<section>
    <script>
        async function onClick(event){
            event.preventDefault();
            const inputs = [...document.querySelectorAll('input')].filter(x => x.checked);
            const textInputs = [...document.querySelectorAll('textarea')];
            const testId = document.getElementById('testId').value;
            const params = {
                "TestId": testId,
                "Answers": []
            };
            for(let radio of inputs){
                const answer = { "QuestionId": radio.name , "AnswerId": radio.id};
                params.Answers.push(answer);
            }
            for (let text of textInputs) {
                const answer = { "QuestionId": text.id, "TextAnswer": text.value};
                params.Answers.push(answer);
            }
            const json = JSON.stringify(params);
            console.log(params);
            const response = await fetch('/Users/Tests/Compete', {
                method: "post", 
                headers: {
                    'Content-Type': 'application/json'
                },
                body: json
            });
            const points = await response.json();
            
            alert(`Your points are: ${points}`);
            document.location = '/Users/Home/Index';
        }
    </script>
</section>
